<html>
  <head>
  </head>
  <body>
    <script type="text/javascript">
    // attempt to parse the fragment id
    var params = {},
    queryString = location.hash.substring(1),
    regex = /([^&=]+)=([^&]*)/g;
    while (m = regex.exec(queryString)) {
        params[decodeURIComponent(m[1]).replace(/\+/g, ' ')] =
            decodeURIComponent(m[2].replace(/\+/g, ' '));
    }
    var expectedState = frameElement.getAttribute('anti_csrf_state');
    // then deposit it where it can be read
    if (params.error) {
        window.parent.receive_error(params.error);
    }
    else if (params.token_type == 'Bearer' &&
             expectedState == params.state && // CSRF check
             params.expires_in > 0) {
        window.parent.receive_token(params.access_token);
    }
    else {
        window.parent.receive_error("unspecified_error");
    }
    </script>
  </body>
</html>
